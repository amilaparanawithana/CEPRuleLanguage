<div class="content-header-wrapper">
    <div class="header-back-arrow" [routerLink]="['../ProjectList']"></div>
    <p class="ips-page-header">Configurations of {{project.name}} </p>
</div>

<div class="content-body-wrapper">
    <form class="form form-horizontal">
        <div class="form-group">
            <label class="control-label col-md-2">Name:</label>
            <div class="col-md-9">
                <p class="form-control-static">{{project.name}}</p>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-md-2">Users:</label>
            <div class="col-md-9">
                <div *ngFor="#user of allUsers">
                <div class="checkbox checkbox-inline">
                    <input type="checkbox" id="user.name" [checked]="user.selected"
                           (click)="user.check()">
                    <label>
                        {{ user.name }}
                    </label>
                </div>
                </div>

                <button class="btn btn-default pull-right" (click)="updateUsers()">
                    Update
                </button>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-md-2">Cluster:</label>
            <div class="col-md-9">
                <table class="table table-striped table-responsive"
                       *ngIf="clusterObj">
                    <thead>
                    <tr>
                        <th>Name</th>
                        <th>Replications</th>
                        <th>Port Range</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>{{clusterObj.name}}</td>
                        <td>{{clusterObj.replicationCounter}}</td>
                        <td>{{clusterObj.portFrom}} - {{clusterObj.portTo}}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="form-group">
            <label class="control-label col-md-2">Configuration :</label>
            <div class="col-md-9">
                <div class="row" style="margin-bottom: 20px;">
                    <div class="pull-right">
                        <button class="btn btn-primary pull-right" (click)="swapAddConfig()" [disabled]="addConfig">
                            Add
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <div class="row" *ngIf="addConfig">
        <div class="panel panel-default">
            <div class="panel-heading">
                New Ultraesb Configuration {{newConfigurationType}}
            </div>
            <div class="panel-body">
                <form class="form form-horizontal">
                    <div class="form-group">
                        <label class="control-label col-md-2">Type :</label>
                        <div class="col-md-9">
                            <div class="input-group">
                                <select class="form-control" (change)="changeConfigType($event.target.value)">
                                    <option value="0" selected>Deployment Unit</option>
                                    <option value="1">Configuration</option>
                                    <option value="2">Library</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="form-group" *ngIf="newConfigurationType !== null">
                        <label class="control-label col-md-2">File :</label>
                        <div class="col-md-10">
                            <div class="dropzone" id="drop-zone">

                            </div>
                        </div>
                    </div>
                    <div class="form-group" *ngIf="newConfigurationType==0">
                        <label class="control-label col-md-2">Open Ports :</label>
                        <div class="col-md-10">
                            <input type="text" class="form-control" id="enabledPorts" [(ngModel)]="portList">
                        </div>
                    </div>

                    <!--If the config type is a Deployment Unit there is no local path-->
                    <div class="form-group" *ngIf="newConfigurationType!=0">
                        <label class="control-label col-md-2">Path :</label>
                        <div class="col-md-10">
                            <input type="text" class="form-control" id="configPath" [(ngModel)]="filePath"
                                   [placeholder]="newConfigurationType===1?'path related to ESB_HOME/conf .. eg: path / represent ESB_HOME/conf, path /xsd/ represent ESB_HOME/conf/xsd/':'path related to ESB_HOME/lib .. eg: path / represent ESB_HOME/lib/, path /patches/ represent ESB_HOME/lib/patches/'">
                        </div>
                    </div>

                    <div class="form-group  pull-right">
                        <div class="btn-group col-md-12" role="group">
                            <button type="button" class="btn btn-default" (click)="swapAddConfig()" *ngIf="addConfig">
                                Cancel
                            </button>
                            <button type="button" class="btn btn-default" (click)="addNewConfig()" *ngIf="addConfig">
                                Done
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div class="row config-panel">

    <div *ngIf="getDeploymentUnits().length == 0 && getConfigFiles().length == 0 && getLibraries().length == 0" >
       <div class="no-config">
        <label style="margin-top: 57px;font-weight: 300;font-size: 16px">Add project configuration, save then deploy</label>
        </div>

    </div>
    <div *ngIf="getDeploymentUnits().length > 0" class="row config-div">
        Deployment Units
        <ul class="list-group">
            <li class="list-group-item" *ngFor="#config of getDeploymentUnits()">
                <span [class.text-strike]="config.isDeleted()">
                {{config.name}}
                </span>
                <span class="pull-right" *ngIf="config.isProcessing()"><img src="resources/global/img/ajax-loader.gif"></span>
                <span *ngIf="!config.isProcessing()">
                    <a class="btn btn-small btn-danger pull-right " aria-hidden="true"
                       (click)="removeConfig(config)" *ngIf="!config.isDeleted()">Delete</a>
                    <span *ngIf="config.hasError()">
                        <a class="btn btn-small btn-success pull-right " aria-hidden="true"
                           (click)="config.refresh()">Retry</a>
                        <span class="label pull-right label-danger">{{ config.getError() }}</span>
                    </span>

                    <span class="label pull-right">{{ config.getConfLabel() }}</span>
                    <span class="label pull-right" *ngIf="!config.hasError()">{{ config.getStatus() }}</span>
                </span>
            </li>
        </ul>
    </div>

    <div *ngIf="getConfigFiles().length > 0" class="row config-div">
        Configuration Files
        <ul class="list-group">
            <li class="list-group-item" *ngFor="#config of getConfigFiles()">
                <span [class.text-strike]="config.isDeleted()">
                {{config.name}}
                </span>
                <span class="pull-right" *ngIf="config.isProcessing()"><img src="resources/global/img/ajax-loader.gif"></span>
                <span *ngIf="!config.isProcessing()">
                    <a class="btn btn-small btn-danger pull-right " aria-hidden="true"
                       (click)="removeConfig(config)" *ngIf="!config.isDeleted()">Delete</a>
                    <span *ngIf="config.hasError()">
                        <a class="btn btn-small btn-success pull-right " aria-hidden="true"
                           (click)="config.refresh()">Retry</a>
                        <span class="label pull-right label-danger">{{ config.getError() }}</span>
                    </span>

                    <span class="label pull-right">{{ config.url }}</span>
                    <span class="label pull-right">{{ config.getConfLabel() }}</span>
                    <span class="label pull-right" *ngIf="!config.hasError()">{{ config.getStatus() }}</span>
                </span>
            </li>
        </ul>
    </div>

    <div *ngIf="getLibraries().length > 0" class="row config-div">
        Libraries
        <ul class="list-group">
            <li class="list-group-item" *ngFor="#config of getLibraries()">
                <span [class.text-strike]="config.isDeleted()">
                {{config.name}}
                </span>
                <span class="pull-right" *ngIf="config.isProcessing()"><img src="resources/global/img/ajax-loader.gif"></span>
                <span *ngIf="!config.isProcessing()">
                    <a class="btn btn-small btn-danger pull-right " aria-hidden="true"
                       (click)="removeConfig(config)" *ngIf="!config.isDeleted()">Delete</a>
                    <span *ngIf="config.hasError()">
                        <a class="btn btn-small btn-success pull-right " aria-hidden="true"
                           (click)="config.refresh()">Retry</a>
                        <span class="label pull-right label-danger">{{ config.getError() }}</span>
                    </span>

                    <span class="label pull-right">{{ config.url }}</span>
                    <span class="label pull-right">{{ config.getConfLabel() }}</span>
                    <span class="label pull-right" *ngIf="!config.hasError()">{{ config.getStatus() }}</span>
                </span>
            </li>
        </ul>
    </div>
    </div>

    <div class="pull-right row" style="margin-bottom: 30px;margin-top: 30px;margin-right: 100px ">
        <button class="btn btn-default pull-right" (click)="deployConfig()" [disabled]="addConfig">
            Deploy
        </button>
        <button class="btn btn-success pull-right" (click)="onConfigSave()" [disabled]="addConfig">
            Save
        </button>
    </div>
</div>